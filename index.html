<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BhuYatra - Smart Travelling with AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- A-Frame for AR/VR -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
             scroll-behavior: smooth; /* Apply smooth scroll globally */
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: #333;
            overflow-x: hidden;
            background-color: #f8f9fa;
        }

        /* Loader Styles */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #0077b6;
            z-index: 2000;
            transition: opacity 0.5s ease-out;
        }

        .loader {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .loader-logo {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .loader-circle {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 100%;
            height: 100%;
            animation: spin 1s linear infinite;
        }

        .loader-progress {
            position: absolute;
            bottom: -40px;
            font-size: 16px;
            color: white;
        }

        .loader-text {
            margin-top: 60px;
            color: white;
            font-size: 18px;
            text-align: center;
        }

        .loader-text span {
            display: inline-block;
            animation: loadingText 1.5s infinite;
        }

        .loader-text span:nth-child(2) { animation-delay: 0.2s; }
        .loader-text span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loadingText {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Main Container Styles */
        .main-container {
            display: none; /* Initially hidden */
            width: 100%;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: transparent; /* Adjusted in media query for fixed header */
            position: absolute; /* Adjusted to fixed in media query */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100; /* Ensure header is above hero content but below modal/chatbot */
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        header.scrolled { /* Style for scrolled header */
             background-color: #fff;
             position: fixed;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 24px;
            color: #0077b6;
        }

        .logo img {
            height: 40px;
            margin-right: 10px;
        }

        .logo-text {
            background: linear-gradient(90deg, #0077b6, #00b4d8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 30px;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            padding-bottom: 5px; /* Space for potential active indicator */
        }

        nav ul li a:hover, nav ul li a.active {
            color: #0077b6;
            /* Optional: Add underline or border for active link */
            /* border-bottom: 2px solid #0077b6; */
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
            z-index: 101; /* Above nav */
        }

        /* Hero Section Styles */
        .hero {
            display: flex;
            min-height: 100vh;
            position: relative;
            background-color: #fff; /* Background for the left side */
        }

        .hero-left {
            flex: 1;
            padding: 140px 5% 60px; /* Increased top padding for header */
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .hero-right {
            flex: 1;
            position: relative;
            overflow: hidden; /* Ensure iframe doesn't overflow */
            min-height: 300px; /* Minimum height */
        }

        .hero-right::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 119, 182, 0.3);
            z-index: 1; /* Above map, below header */
            pointer-events: none; /* Allow interaction with map */
        }

        /* Style for the map iframe */
        .hero-map-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            z-index: 0; /* Behind overlay */
        }


        .hero-content {
            max-width: 600px;
        }

        .hero-tagline, .hero-title, .hero-description, .hero-form, .cta-buttons {
            opacity: 0;
            transform: translateY(20px);
            /* Animation managed by JS after load */
            animation: fadeInUp 0.8s forwards paused; /* Start paused */
        }
        .hero-tagline { animation-delay: 0.5s; font-size: 18px; color: #00b4d8; margin-bottom: 15px; }
        .hero-title { animation-delay: 0.7s; font-size: 48px; font-weight: 700; margin-bottom: 20px; color: #333; line-height: 1.2; }
        .hero-title span { color: #0077b6; }
        .hero-description { animation-delay: 0.9s; font-size: 18px; line-height: 1.6; margin-bottom: 30px; color: #555; }
        .hero-form { animation-delay: 1.1s; background-color: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); margin-top: 20px; }
        .cta-buttons { animation-delay: 1.3s; display: flex; gap: 15px; margin-top: 30px; }

        .form-title { font-size: 24px; margin-bottom: 20px; color: #333; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus { border-color: #0077b6; outline: none; }

        .btn { padding: 12px 30px; border-radius: 30px; font-weight: 600; font-size: 16px; transition: all 0.3s ease; cursor: pointer; text-decoration: none; text-align: center; display: inline-flex; align-items: center; justify-content: center; }
        .btn-primary { background: linear-gradient(90deg, #0077b6, #00b4d8); color: white; border: none; box-shadow: 0 4px 15px rgba(0, 119, 182, 0.3); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0, 119, 182, 0.4); }
        .btn-secondary { background-color: transparent; color: #0077b6; border: 2px solid #0077b6; }
        .btn-secondary:hover { background-color: rgba(0, 119, 182, 0.1); transform: translateY(-3px); }

        /* Section Base Styles */
        section {
            padding: 100px 5%;
            position: relative;
            overflow: hidden; /* Prevent horizontal scrollbars from animations */
        }
        .section-header { text-align: center; margin-bottom: 60px; }
        .section-subtitle { color: #00b4d8; font-size: 18px; margin-bottom: 10px; display: block; }
        .section-title { font-size: 36px; color: #333; margin-bottom: 20px; font-weight: 700;}
        .section-description { max-width: 700px; margin: 0 auto; font-size: 18px; color: #555; line-height: 1.6; }

        /* About Section */
        .about-section { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .about-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(2, 1fr); gap: 60px; align-items: center; }
        .about-content, .about-image { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .about-subtitle { color: #0077b6; font-weight: 600; font-size: 18px; margin-bottom: 15px; display: block; }
        .about-title { font-size: 36px; font-weight: 700; margin-bottom: 25px; line-height: 1.3; background: linear-gradient(90deg, #0077b6, #00b4d8); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .about-description { color: #555; line-height: 1.8; margin-bottom: 30px; }
        .key-features { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px; }
        .key-feature { display: flex; align-items: flex-start; gap: 15px; padding: 15px; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease; }
        .key-feature:hover { transform: translateY(-5px); }
        .key-feature i { font-size: 24px; color: #0077b6; font-style: normal; width: 30px; text-align: center; line-height: 1; /* Better vertical align for emojis */}
        .key-feature-content h4 { font-size: 16px; margin-bottom: 5px; color: #333; }
        .key-feature-content p { font-size: 14px; color: #666; line-height: 1.6; }
        .about-image { position: relative; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0, 119, 182, 0.15); height: 450px; }
        .about-image img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .about-image::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(0, 119, 182, 0.2), rgba(0, 180, 216, 0.2)); z-index: 1; }

        /* Features Section */
        .features { background-color: #f8f9fa; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 50px; }
        .feature-card { background-color: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.6s ease-out; opacity: 0; transform: translateY(30px); }
        .feature-card:hover { transform: translateY(-10px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); }
        .feature-icon { background: linear-gradient(120deg, #0077b6, #00b4d8); display: flex; align-items: center; justify-content: center; height: 80px; font-size: 36px; color: white; }
        .feature-content { padding: 30px; }
        .feature-title { font-size: 20px; font-weight: 600; margin-bottom: 15px; color: #333; }
        .feature-description { color: #666; line-height: 1.6; font-size: 16px; }

        /* How It Works Section */
        .how-it-works { background-color: #fff; }
        .steps-container { display: flex; justify-content: space-between; margin-top: 60px; position: relative; }
        .steps-container::before { content: ''; position: absolute; top: 30px; left: 15%; width: 70%; height: 3px; background: linear-gradient(90deg, rgba(0,119,182,0.2), rgba(0,180,216,0.2)); z-index: 1; } /* Softened line */
        .step { width: 25%; text-align: center; position: relative; z-index: 2; opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .step-number { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(120deg, #0077b6, #00b4d8); color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 600; margin: 0 auto 20px; position: relative; box-shadow: 0 4px 10px rgba(0, 119, 182, 0.3); }
        .step-title { font-size: 20px; font-weight: 600; margin-bottom: 15px; color: #333; }
        .step-description { color: #666; font-size: 16px; line-height: 1.6; padding: 0 10px; }

        /* CTA Section */
        .cta-section { padding: 80px 5%; background: linear-gradient(120deg, #0077b6, #00b4d8); text-align: center; color: white; }
        .cta-title { font-size: 36px; margin-bottom: 20px; font-weight: 700; }
        .cta-description { font-size: 18px; margin-bottom: 40px; max-width: 700px; margin-left: auto; margin-right: auto; line-height: 1.6; }
        .cta-section .cta-buttons { justify-content: center; opacity: 1; transform: none; animation: none; }
        .cta-section .cta-buttons .btn-secondary { background-color: white; color: #0077b6; border: none; }
        .cta-section .cta-buttons .btn-secondary:hover { background-color: rgba(255, 255, 255, 0.9); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); }

        /* AR/VR Section */
        .ar-vr-section { background-color: #e9ecef; /* Slightly different background */ }
        .ar-vr-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; margin-top: 50px; }
        .ar-feature, .vr-feature { background-color: #fff; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); padding: 30px; max-width: 400px; text-align: left; opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out, box-shadow 0.3s ease; }
        .ar-feature:hover, .vr-feature:hover { box-shadow: 0 15px 40px rgba(0, 119, 182, 0.15); transform: translateY(-5px);}
        .ar-feature h3, .vr-feature h3 { font-size: 24px; color: #0077b6; margin-bottom: 15px; }
        .ar-feature p, .vr-feature p { font-size: 16px; color: #555; line-height: 1.6; margin-bottom: 20px; }
        /* Removed onclick from button elements here - functionality moved to modal */
        .ar-feature button, .vr-feature button { margin-top: 10px; }
        #open-ar-vr-popup { /* Style for the main explore button */ margin-top: 30px; display: inline-block; } /* Added margin */

        /* Testimonials Section */
        .testimonials { background-color: #f8f9fa; }
        .testimonial-slider { margin-top: 50px; position: relative; max-width: 1100px; margin-left: auto; margin-right: auto; display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; }
        .testimonial-item { background-color: #fff; border-radius: 15px; padding: 40px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); text-align: center; opacity: 0; transform: translateY(30px); width: calc(33.333% - 20px); min-width: 280px; margin: 0; transition: opacity 0.6s ease-out, transform 0.6s ease-out, box-shadow 0.3s ease; display: flex; flex-direction: column; justify-content: space-between; }
        .testimonial-item:hover { box-shadow: 0 15px 40px rgba(0, 119, 182, 0.1); transform: translateY(-5px); }
        .testimonial-text { font-size: 17px; line-height: 1.7; color: #555; margin-bottom: 30px; position: relative; font-style: italic; flex-grow: 1; }
        .testimonial-text::before, .testimonial-text::after { content: '"'; font-size: 50px; color: rgba(0, 119, 182, 0.1); position: absolute; line-height: 0; }
        .testimonial-text::before { top: 5px; left: -15px; }
        .testimonial-text::after { bottom: -15px; right: -15px; }
        .testimonial-author { display: flex; align-items: center; justify-content: center; margin-top: auto; /* Push author to bottom */ }
        .author-avatar { width: 60px; height: 60px; border-radius: 50%; overflow: hidden; margin-right: 15px; flex-shrink: 0; }
        .author-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .author-info { text-align: left; }
        .author-name { font-weight: 600; font-size: 18px; color: #333; }
        .author-title { color: #666; font-size: 14px; }

        /* Footer */
        footer { padding: 60px 5% 30px; background-color: #333; color: #fff; }
        .footer-content { display: flex; flex-wrap: wrap; justify-content: space-between; margin-bottom: 40px; gap: 30px; }
        .footer-logo { font-size: 28px; font-weight: 700; margin-bottom: 20px; color: #fff; background: linear-gradient(90deg, #00a8e8, #00b4d8); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .footer-info { max-width: 400px; flex-basis: 30%; min-width: 250px; }
        .footer-info p { margin-bottom: 20px; line-height: 1.6; color: #ccc; }
        .footer-links, .footer-newsletter { flex-basis: 20%; min-width: 180px;}
        .footer-links h3, .footer-newsletter h3 { font-size: 20px; margin-bottom: 20px; color: #fff; font-weight: 600; }
        .footer-links ul { list-style: none; }
        .footer-links ul li { margin-bottom: 10px; }
        .footer-links ul li a { color: #ccc; text-decoration: none; transition: color 0.3s, transform 0.2s; display: inline-block;}
        .footer-links ul li a:hover { color: #00b4d8; transform: translateX(5px); }
        .footer-newsletter p { color: #ccc; margin-bottom: 20px; line-height: 1.6; }
        .newsletter-form { display: flex; }
        .newsletter-form input { flex: 1; padding: 12px 15px; border: none; border-radius: 5px 0 0 5px; font-size: 16px; background-color: #555; color: #fff; }
        .newsletter-form input::placeholder { color: #bbb; }
        .newsletter-form button { background-color: #00b4d8; border: none; padding: 0 20px; border-radius: 0 5px 5px 0; color: white; cursor: pointer; transition: background-color 0.3s; font-size: 18px; line-height: 1; }
        .newsletter-form button:hover { background-color: #0077b6; }
        .footer-bottom { text-align: center; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #aaa; font-size: 14px; }
        .social-links { display: flex; margin-top: 20px; }
        .social-links a { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; color: #fff; text-decoration: none; margin-right: 10px; transition: background-color 0.3s, transform 0.2s; font-family: "Font Awesome 6 Brands", "Font Awesome 6 Free"; font-weight: 400; /* Use Brands for brand icons */ font-size: 18px; }
        .social-links a:hover { background-color: #00b4d8; transform: scale(1.1); }
        /* Updated Font Awesome classes */
        .social-links a.fa-facebook-f::before { content: "\f39e"; }
        .social-links a.fa-twitter::before { content: "\f099"; }
        .social-links a.fa-linkedin-in::before { content: "\f0e1"; }
        .social-links a.fa-instagram::before { content: "\f16d"; }


        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .hero { flex-direction: column; }
            .hero-left, .hero-right { flex: none; width: 100%; }
            .hero-right { height: 50vh; min-height: 400px; margin-top: 0; border-radius: 0; } /* Adjusted */
            .hero-left { padding: 100px 5% 40px; } /* Adjusted padding */

            .steps-container::before { left: 10%; width: 80%; }
            .testimonial-item { width: calc(50% - 15px); }
            .about-container { grid-template-columns: 1fr; gap: 40px; }
            .about-content { padding-right: 0; }
            .key-features { grid-template-columns: 1fr; } /* Single column */
            .about-image { height: 350px; }
            .footer-info, .footer-links, .footer-newsletter { flex-basis: 45%; } /* 2 columns */
        }

        @media (max-width: 768px) {
            .section-title, .about-title, .cta-title { font-size: 30px; }
            .hero-title { font-size: 36px; }

            header {
                padding: 15px 5%;
                background-color: #fff;
                position: fixed;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            /* Add padding to body to prevent content from hiding behind fixed header */
            body { padding-top: 70px; /* Match header height */ }
             .hero-left { padding-top: 40px; /* Adjust since body has padding now */ }


            /* Mobile Nav Styling */
            nav ul {
                display: none; /* Hide by default */
                flex-direction: column;
                position: absolute;
                top: 100%; /* Position below header */
                right: 0;
                background-color: white;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                border-radius: 0 0 8px 8px;
                padding: 15px;
                width: 100%; /* Full width */
                z-index: 99; /* Below header */
                border-top: 1px solid #eee;
            }
            nav ul.active { display: flex; }
            nav ul li { margin-left: 0; margin-bottom: 15px; width: 100%; text-align: center;}
            nav ul li:last-child { margin-bottom: 0; }
            nav ul li a { color: #333; display: block; padding: 10px;}
            /* End Mobile Nav Styling */

            .mobile-menu-btn { display: block; }

            .cta-buttons { flex-direction: column; }
            .btn { width: 100%; margin-bottom: 10px; }
            .cta-buttons .btn:last-child { margin-bottom: 0;}

            .steps-container { flex-direction: column; align-items: center; gap: 40px; }
            .steps-container::before { display: none; }
            .step { width: 90%; max-width: 350px; }

            .footer-content { flex-direction: column; }
            .footer-info, .footer-links, .footer-newsletter { width: 100%; margin-bottom: 30px; flex-basis: auto; }

            .features-grid { grid-template-columns: 1fr; }
            .testimonial-item { width: 100%; }
            .about-section, .features, .how-it-works, .ar-vr-section, .testimonials { padding: 60px 5%; }
            .about-image { height: 300px; }
            .key-features { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .hero-title { font-size: 32px; }
            .section-title, .about-title, .cta-title { font-size: 28px; }
            .hero-form { padding: 20px; }
            .form-title { font-size: 20px; }
            .testimonial-text { font-size: 16px;}
            .testimonial-text::before { left: -10px; }
            .testimonial-text::after { right: -10px; }
        }


        /* --- START: Chatbot Styles --- */
        :root {
            --chatbot-primary: #0077b6; /* Aligned with site primary */
            --chatbot-secondary: #00b4d8; /* Aligned with site secondary */
            --chatbot-accent: #e74c3c;
            --chatbot-light: #f9f9f9;
            --chatbot-dark: #34495e;
            --chatbot-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            --chatbot-border-radius: 12px;
        }

        .chatbot-container {
            width: 380px;
            max-width: calc(100% - 30px); /* Max width with padding */
            height: 600px;
            max-height: calc(100vh - 100px); /* Max height relative to viewport */
            background-color: white;
            border-radius: var(--chatbot-border-radius);
            box-shadow: var(--chatbot-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: opacity 0.3s ease, transform 0.3s ease;
            position: fixed;
            bottom: 90px; /* Adjusted position */
            right: 20px;
            z-index: 1100; /* High z-index */
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            pointer-events: none;
            font-family: 'Poppins', sans-serif; /* Use main site font */
        }

        .chatbot-container.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .chat-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--chatbot-primary), var(--chatbot-secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .chat-header h3 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            margin-bottom: 0;
            color: white;
        }

        .chat-header h3 img {
            width: 30px;
            height: 30px;
            margin-right: 10px;
            border-radius: 50%;
            object-fit: cover;
            background-color: rgba(255,255,255,0.2);
        }

        .header-icons { display: flex; gap: 10px; }
        .header-icon {
            cursor: pointer; font-size: 16px; color: white;
            background: rgba(255, 255, 255, 0.2);
            width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: background-color 0.2s; border: none; padding: 0;
        }
        .header-icon:hover { background: rgba(255, 255, 255, 0.4); }

        .chat-body {
            flex: 1; /* Take remaining space */
            padding: 20px;
            overflow-y: auto;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* Custom scrollbar for chat body */
        .chat-body::-webkit-scrollbar { width: 6px; }
        .chat-body::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px;}
        .chat-body::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px;}
        .chat-body::-webkit-scrollbar-thumb:hover { background: #aaa; }


        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word; /* Ensure long words break */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            background-color: #e9ecef;
            color: var(--chatbot-dark);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        .bot-message-content { /* Inner span for streaming */
             display: inline; /* Or block depending on desired layout */
        }

        .user-message {
            background: linear-gradient(135deg, var(--chatbot-primary), var(--chatbot-secondary));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message i.fa-robot { margin-right: 8px; vertical-align: top; /* Align icon better */}
        .message i.fa-user { margin-left: 8px; vertical-align: top; }

        .typing-indicator {
            display: flex;
            align-items: center;
            align-self: flex-start;
            background-color: #e9ecef;
            padding: 10px 14px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s;
            margin-top: 5px;
            height: 36px; /* Fixed height */
            box-sizing: border-box;
        }
        .typing-indicator.active { opacity: 1; }

        .typing-dot {
            width: 8px; height: 8px; background-color: #aaa;
            border-radius: 50%; margin: 0 3px;
            animation: typingBounce 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        .chat-footer {
            padding: 15px; background-color: white;
            border-top: 1px solid #e9ecef; display: flex;
            align-items: center; gap: 10px; flex-shrink: 0;
        }
        .chat-input-container { flex: 1; position: relative; }
        .chat-input {
            width: 100%;
            padding: 12px 75px 12px 20px; /* Increased right padding for buttons */
            border: 1px solid #dde0e4;
            border-radius: 25px; outline: none; font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: 'Poppins', sans-serif; /* Match main site font */
            resize: none; /* Prevent textarea resize */
            line-height: 1.4;
        }
        .chat-input:focus {
            border-color: var(--chatbot-primary);
            box-shadow: 0 0 0 2px rgba(0, 119, 182, 0.2);
        }

        .message-actions {
            display: flex; position: absolute; right: 8px;
            top: 50%; transform: translateY(-50%); gap: 5px;
        }
        .action-btn {
            background: none; border: none; cursor: pointer; color: #8d96a0;
            font-size: 18px; width: 34px; height: 34px; display: flex;
            align-items: center; justify-content: center; border-radius: 50%;
            transition: color 0.2s, background-color 0.2s; padding: 0;
        }
        .action-btn:hover { color: var(--chatbot-primary); background-color: rgba(0, 119, 182, 0.1); }
        .action-btn.active { color: var(--chatbot-accent); }
        .send-btn { /* Keep distinct style */
            color: white; background: linear-gradient(135deg, var(--chatbot-primary), var(--chatbot-secondary));
        }
         .send-btn:hover {
            color: white; transform: scale(1.05);
            background: linear-gradient(135deg, var(--chatbot-primary), var(--chatbot-secondary));
        }


        .chat-toggle {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #0077b6, #00b4d8);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0, 119, 182, 0.4);
            z-index: 1001; /* Above content, below open chatbot */
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease-in-out 0.5s, transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Delayed opacity */
        }
        .chat-toggle.visible { opacity: 1; pointer-events: auto; }
        .chat-toggle:hover { transform: scale(1.1) translateY(-3px); box-shadow: 0 8px 20px rgba(0, 119, 182, 0.5); }
        .chat-toggle i { color: white; font-size: 24px; transition: transform 0.3s ease-in-out; }
        .chat-toggle.active i { transform: rotate(180deg); } /* Rotate X instead */

        .suggestion-pills {
            display: flex; flex-wrap: wrap; gap: 8px;
            padding: 5px 0 0 0; /* Adjust padding */
            margin-left: -10px; /* Negative margin to align with bot message padding */
            margin-right: -10px;
            padding-left: 10px; /* Add padding back */
            padding-right: 10px;
             margin-top: -5px; /* Reduce space after bot message */
             margin-bottom: 5px;
        }
        .suggestion-pill {
            background-color: rgba(0, 119, 182, 0.1);
            color: var(--chatbot-primary);
            border: 1px solid rgba(0, 119, 182, 0.2);
            border-radius: 16px; padding: 5px 12px; font-size: 12px;
            cursor: pointer; transition: all 0.2s; white-space: nowrap;
             font-weight: 500;
        }
        .suggestion-pill:hover { background-color: rgba(0, 119, 182, 0.2); transform: translateY(-1px); border-color: rgba(0, 119, 182, 0.4); }

        .status-indicator {
            padding: 8px 12px; background-color: #fffbe6; /* Warning yellow */
            color: #92400e; border: 1px solid #fde68a;
            border-radius: 8px; font-size: 12px;
            margin: 5px auto 10px auto; display: none;
            max-width: 90%; text-align: center;
        }
        .status-indicator.active { display: block; animation: fadeIn 0.3s ease; }
        .status-indicator.error { background-color: #fef2f2; color: #ef4444; border-color: #fecaca;} /* Error style */


        /* Responsive design for Chatbot */
        @media (max-width: 768px) {
            /* Make chatbot take full screen on mobile when active */
            .chatbot-container.active {
                width: 100%; height: 100%; max-width: 100%; max-height: 100%;
                bottom: 0; right: 0; border-radius: 0;
                z-index: 1500; /* Ensure above fixed header */
                transition: none; /* Optional: remove transition for instant full screen */
                max-height: none; /* Override max height */
                bottom: 0 !important; /* Override bottom position */
                right: 0 !important; /* Override right position */

            }
             /* Hide toggle when chat is fullscreen */
            .chatbot-container.active + .chat-toggle {
                 opacity: 0 !important;
                 pointer-events: none !important;
            }

            .chat-toggle { bottom: 15px; right: 15px; width: 55px; height: 55px; }
            .chat-toggle i { font-size: 22px; }
             body.chatbot-open {
                 overflow: hidden; /* Prevent scrolling background when chatbot is fullscreen */
             }
        }
        /* --- END: Chatbot Styles --- */

        /* --- START: Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1200; /* Above chatbot toggle, below modal content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 900px; /* Limit max width */
            height: 85%;
            max-height: 700px; /* Limit max height */
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1300; /* Above overlay */
            overflow: hidden; /* Contains the content */
            display: flex; /* Use flex for layout */
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s linear 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .modal-content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            height: 100%; /* Ensure content area tries to fill modal */
            overflow: hidden; /* Prevent internal scrollbars unless needed by view */
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            line-height: 1;
            color: #888;
            cursor: pointer;
            padding: 0;
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #333;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 24px;
            text-align: center;
            flex-shrink: 0; /* Prevent title from shrinking */
        }

        .modal-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            flex-shrink: 0; /* Prevent tabs from shrinking */
        }

        .modal-tab-btn {
            padding: 10px 20px;
            margin: 0 5px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            color: #555;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            font-weight: 500;
        }

        .modal-tab-btn:hover {
            background-color: #eee;
            border-color: #ccc;
        }

        .modal-tab-btn.active {
            background-color: #0077b6;
            color: white;
            border-color: #0077b6;
        }

        .modal-instructions {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f0f7fc;
            border-radius: 8px;
            border: 1px solid #d1e7f7;
             flex-shrink: 0; /* Prevent instructions shrinking */
        }
         .modal-instructions strong { color: #005a87;}
         .modal-instructions a { color: #0077b6; text-decoration: none; }
         .modal-instructions a:hover { text-decoration: underline; }

        .modal-view {
            display: none; /* Hide views by default */
            flex-grow: 1; /* Allow view to take remaining space */
            position: relative; /* Needed for potential absolute positioning inside */
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden; /* Ensure A-Frame fits */
            background-color: #f0f0f0; /* Background while loading */
        }

        .modal-view.active {
            display: block; /* Show active view */
        }

        /* Style for A-Frame scenes inside modal */
        .modal-view a-scene {
            width: 100%;
            height: 100%;
            display: block; /* Ensure it behaves like a block element */
        }

        .loading-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #777;
            font-size: 16px;
        }

        /* Responsive adjustments for modal */
        @media (max-width: 768px) {
            .modal {
                width: 95%;
                height: 90%;
                max-height: 90vh; /* Adjust max height */
            }
            .modal-content {
                padding: 15px;
            }
            .modal-content h2 {
                font-size: 20px;
                margin-bottom: 15px;
            }
             .modal-tabs {
                 flex-wrap: wrap; /* Allow wrapping on small screens */
                 margin-bottom: 10px;
             }
            .modal-tab-btn {
                padding: 8px 15px;
                font-size: 14px;
                margin: 5px;
            }
            .modal-instructions {
                font-size: 13px;
                padding: 8px;
                margin-bottom: 10px;
            }
        }
        /* --- END: Modal Styles --- */
            /* --- START: Integrated 360 Explorer Styles --- */

    #explore-360-view-container {
         /* Initially hidden by class 'hidden', shown by JS */
         transition: opacity 0.4s ease-in-out;
         opacity: 1; /* Start visible for transition effect if needed */
    }
    #explore-360-view-container.hidden {
        display: none;
        opacity: 0;
         /* Ensure it's fully hidden */
         height: 0;
         overflow: hidden;
         padding-top: 0;
         padding-bottom: 0;
         margin-top: 0;
         margin-bottom: 0;
         border: none;
    }


    /* Destination List Styles (Copied & adapted from explore.html) */
    #destination-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .destination-card {
        background-color: #fff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        border: 1px solid #eee;
    }
    .destination-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 35px rgba(0, 119, 182, 0.15);
    }
    .destination-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        display: block;
    }
    .destination-card h3 {
        font-size: 18px;
        font-weight: 600;
        padding: 15px 20px 10px;
        color: #0077b6;
        margin: 0;
        text-align: center;
    }
    .destination-card p {
        font-size: 14px;
        color: #555;
        padding: 0 20px 15px;
        text-align: center;
        flex-grow: 1; /* Helps align content if descriptions vary */
        min-height: 40px; /* Give some minimum space */
    }

    /* Viewer Section Styles (Copied & adapted from explore.html) */
    #viewer-section {
        /* Initially hidden by class 'hidden', shown by JS */
        /* display: flex; /* Set directly in HTML style */
         flex-direction: column;
         align-items: stretch; /* Stretch children like container */
    }

    #viewer-instructions {
        font-size: 16px;
        color: #555;
        margin-bottom: 20px;
        text-align: center;
        background-color: #e9ecef;
        padding: 10px 15px;
        border-radius: 8px;
        width: 100%;
        /* max-width: 800px; /* Removed to allow full width */
    }
     #viewer-instructions.error {
         background-color: #f8d7da;
         color: #721c24;
         border: 1px solid #f5c6cb;
     }

    #viewer-container {
        width: 100%;
        height: 65vh; /* Adjust height as needed */
        min-height: 400px;
        max-height: 700px;
        background-color: #e0e0e0;
        border-radius: 10px;
        overflow: hidden; /* Crucial for A-Frame */
        position: relative;
        border: 1px solid #ccc;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    #viewer-container a-scene {
        width: 100%;
        height: 100%;
        display: block;
    }

    #loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none; /* Hidden by default, shown by JS */
        flex-direction: column;
        align-items: center;
        color: #555;
        z-index: 10;
        background: rgba(255, 255, 255, 0.8); /* Optional semi-transparent background */
        padding: 20px;
        border-radius: 10px;
    }
    #loading-indicator.active {
        display: flex; /* Show using this class */
    }

    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border-left-color: #0077b6;
        animation: spin 1s ease infinite;
        margin-bottom: 10px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Utility class */
    .hidden {
        display: none !important;
    }

    /* Responsive adjustments for integrated explorer */
    @media (max-width: 768px) {
         #explore-360-view-container .explore-title, /* Adjust if using the title from explore.html */
         #explore-360-view-container #viewer-title {
             font-size: 22px;
         }
         #destination-list {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        #viewer-container {
            height: 50vh;
            min-height: 300px;
        }
        #explore-360-view-container #back-to-list-btn,
        #explore-360-view-container #close-explore-view-btn {
             font-size: 14px;
             padding: 6px 12px;
        }
    }
    /* --- END: Integrated 360 Explorer Styles --- */

    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader">
            <div class="loader-circle"></div>
            <div class="loader-logo">BhuYatra</div>
        </div>
        <div class="loader-progress" id="loader-progress">0%</div>
        <div class="loader-text">
            Preparing your journey <span>.</span><span>.</span><span>.</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container" id="main-content">
        <!-- Header -->
        <header id="main-header">
            <div class="logo">
                <span class="logo-text">BhuYatra</span>
            </div>
            <nav>
                <ul id="main-nav-ul">
                    <li><a href="#about">About</a></li>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#ar-vr">AR & VR</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#testimonials">Testimonials</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
             <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="Toggle Menu" aria-expanded="false">
                 <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Hero Section -->
        <section class="hero" id="home">
            <div class="hero-left">
                <div class="hero-content">
                    <span class="hero-tagline">Discover India Like Never Before</span>
                    <h1 class="hero-title">Explore with <span>BhuYatra</span> AI-Powered Travel Companion</h1>
                    <p class="hero-description">Experience immersive, personalized journeys with cutting-edge AR/VR technology. Let BhuYatra transform how you discover, explore, and remember your travels across India.</p>
                    <div class="cta-buttons">
                        <a href="#features" class="btn btn-primary">Start Exploring</a>
                        <a href="#demo" class="btn btn-secondary">Try Demo</a>
                    </div>
                    <div class="hero-form">
                        <h3 class="form-title">Quick Plan</h3>
                        <form id="quick-plan-form">
                            <div class="form-group">
                                <label for="destination">Where to?</label>
                                <input type="text" id="destination" name="destination" placeholder="e.g., Goa, Kerala, Taj Mahal" required>
                            </div>
                            <div class="form-group">
                                <label for="travel-date">When?</label>
                                <input type="date" id="travel-date" name="travel-date">
                            </div>
                            <div class="form-group">
                                <label for="travelers">Who?</label>
                                <select id="travelers" name="travelers">
                                    <option value="1">1 Person</option>
                                    <option value="2" selected>2 People</option>
                                    <option value="3">3 People</option>
                                    <option value="4">4+ People</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Create My Itinerary</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="hero-right">
                <iframe class="hero-map-iframe"
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d112073.04732209215!2d77.15857221572166!3d28.62418684795363!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x390cfd5b347eb62d%3A0x52c2b7494e204dce!2sNew%20Delhi%2C%20Delhi!5e0!3m2!1sen!2sin!4v1701178315123!5m2!1sen!2sin"
                        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="Map of New Delhi">
                </iframe>
            </div>
        </section>

        <!-- About Section -->
        <section class="about-section" id="about">
             <div class="about-container">
                <div class="about-content">
                    <span class="about-subtitle">About BhuYatra</span>
                    <h2 class="about-title">Revolutionizing Travel with AI & Immersive Tech</h2>
                    <p class="about-description">BhuYatra blends Artificial Intelligence with Augmented (AR) and Virtual Reality (VR) to redefine exploration. We make travel smarter, more accessible, and profoundly enriching  whether you're planning from home or navigating new paths across India.</p>
                    <div class="key-features">
                        <div class="key-feature">
                            <i><i class="fas fa-brain"></i></i>
                            <div class="key-feature-content">
                                <h4>AI Travel Assistant</h4>
                                <p>Personalized plans & real-time tips.</p>
                            </div>
                        </div>
                        <div class="key-feature">
                             <i><i class="fas fa-vr-cardboard"></i></i>
                            <div class="key-feature-content">
                                <h4>Virtual Tours</h4>
                                <p>Immersive VR previews of landmarks.</p>
                            </div>
                        </div>
                        <div class="key-feature">
                             <i><i class="fas fa-map-marked-alt"></i></i>
                            <div class="key-feature-content">
                                <h4>AR Navigation</h4>
                                <p>Overlay directions & info in real view.</p>
                            </div>
                        </div>
                        <div class="key-feature">
                             <i><i class="fas fa-leaf"></i></i>
                            <div class="key-feature-content">
                                <h4>Eco-Conscious</h4>
                                <p>Promoting sustainable tourism.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="about-image">
                    <img src="https://images.unsplash.com/photo-1528181304800-259b08848526?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80" alt="Traveler using AR navigation on phone">
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features" id="features">
            <div class="section-header">
                <span class="section-subtitle">Our Features</span>
                <h2 class="section-title">Smart Travel with AI (AR/VR)</h2>
                <p class="section-description">Experience travel like never before with innovative tech that brings destinations to life and makes exploration seamless and immersive.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-route"></i></div>
                    <div class="feature-content">
                        <h3 class="feature-title">AR Navigation</h3>
                        <p class="feature-description">Navigate streets and sites with AR directions overlaid on your real-world view.</p>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-tasks"></i></div>
                    <div class="feature-content">
                        <h3 class="feature-title">AI Itineraries</h3>
                        <p class="feature-description">Get custom travel plans based on your interests, time, and budget.</p>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-volume-up"></i></div>
                    <div class="feature-content">
                        <h3 class="feature-title">Audio Guides</h3>
                        <p class="feature-description">Listen to rich historical and cultural narratives as you explore, contextually.</p>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-camera-retro"></i></div>
                    <div class="feature-content">
                        <h3 class="feature-title">Photo Spots AI</h3>
                        <p class="feature-description">AI identifies optimal photo locations and suggests the best angles/times.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="how-it-works" id="how-it-works">
            <div class="section-header">
                <span class="section-subtitle">Simple Process</span>
                <h2 class="section-title">How BhuYatra Works</h2>
                <p class="section-description">Getting started is easy. Follow these simple steps to enhance your travel experience.</p>
            </div>
            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Download App</h3>
                    <p class="step-description">Get BhuYatra from your app store and create an account.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Set Preferences</h3>
                    <p class="step-description">Tell us what you love, and we'll tailor your journey.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Explore AR/VR</h3>
                    <p class="step-description">Point your camera or use VR for immersive interaction.</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3 class="step-title">Share & Save</h3>
                    <p class="step-description">Save your journeys and easily share memorable experiences.</p>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section" id="demo">
            <h2 class="cta-title">Ready to Transform Your Travel?</h2>
            <p class="cta-description">Join thousands discovering the magic of AI-powered exploration with BhuYatra. Try a quick demo or sign up now!</p>
            <div class="cta-buttons">
                <a href="#" class="btn btn-secondary" id="quick-demo-btn">Try Quick Demo</a>
                <a href="auth.html" class="btn btn-primary">Register Now</a> <!-- Changed href to # for demo -->
            </div>
        </section>

        <!-- AR/VR Section -->
        <section class="ar-vr-section" id="ar-vr">
            <div class="section-header">
                <span class="section-subtitle">Immersive Technology</span>
                <h2 class="section-title">Explore with AR & VR</h2>
                <p class="section-description">Experience destinations virtually or enhance your real-world exploration with our cutting-edge AR and VR features.</p>
                 <br>
                 <!-- Ensure this is a button, not a link -->
         <button class="btn btn-primary" id="open-ar-vr-popup">Explore AR/VR Features</button>
            </div>
            <div class="ar-vr-container">
                <!-- These cards are now just informational -->
                <div class="ar-feature">
                     <h3><i class="fas fa-mobile-alt"></i> Augmented Reality (AR)</h3>
                    <p>Use your smartphone to overlay real-time info, directions, and cultural insights onto your surroundings via our AR explorer.</p>
                    <!-- Removed onclick from this button -->
                    <button class="btn btn-primary">Learn More</button>
                </div>
                <div class="vr-feature">
                     <h3><i class="fas fa-headset"></i> Virtual Reality (VR)</h3>
                    <p>Take virtual tours of iconic landmarks from home. Immerse yourself in 360-degree views before you travel using our VR explorer.</p>
                    <!-- Removed onclick from this button -->
                    <button class="btn btn-secondary">Learn More</button>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials" id="testimonials">
            <div class="section-header">
                <span class="section-subtitle">What Travelers Say</span>
                <h2 class="section-title">Traveler Experiences</h2>
                <p class="section-description">Hear from our community who have explored India with BhuYatra.</p>
            </div>
            <div class="testimonial-slider">
                <div class="testimonial-item">
                    <p class="testimonial-text">BhuYatra transformed our Rajasthan trip! AR navigation helped us find hidden gems, and the kids loved the interactive stories!</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                             <img src="https://i.pravatar.cc/60?img=1" alt="Ananya Sharma">
                        </div>
                        <div class="author-info">
                            <h4 class="author-name">Ananya Sharma</h4>
                            <p class="author-title">Family Traveler</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <p class="testimonial-text">Solo travel felt safer and more authentic. Personalized itineraries led me to amazing local spots, navigated confidently with AR.</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <img src="https://i.pravatar.cc/60?img=2" alt="Rajiv Mehta">
                        </div>
                        <div class="author-info">
                            <h4 class="author-name">Rajiv Mehta</h4>
                            <p class="author-title">Solo Explorer</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-item">
                    <p class="testimonial-text">The Photo Spots AI is a game-changer! Captured incredible shots in Kerala. The audio guide provided fascinating cultural insights.</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <img src="https://i.pravatar.cc/60?img=3" alt="Priya Patel">
                        </div>
                        <div class="author-info">
                            <h4 class="author-name">Priya Patel</h4>
                            <p class="author-title">Photography Enthusiast</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- START: Integrated 360 Explorer View -->
    <section id="explore-360-view-container" class="hidden" style="background-color: #fff; padding-top: 60px; padding-bottom: 60px;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 0 5%;"> <!-- Centering container -->

            <!-- Destination Selection Area -->
            <div id="destination-selector">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 20px;">
                     <h2 style="font-size: 28px; font-weight: 600; color: #0077b6;">Select a 360 Destination</h2>
                     <button id="close-explore-view-btn" class="btn btn-secondary" style="padding: 8px 18px; font-size: 15px;">
                          <i class="fas fa-times" style="margin-right: 6px;"></i> Close Explorer
                     </button>
                </div>
                <p style="margin-bottom: 25px; font-size: 16px; color: #555;">Click on a card to load the immersive 360 view.</p>
                <div id="destination-list" style="/* Styles will be added via CSS */">
                    <!-- Destination cards will be loaded here by JS -->
                </div>
            </div>

            <!-- 360 Viewer Area -->
            <div id="viewer-section" class="hidden" style="display: flex; flex-direction: column;"> <!-- Added display:flex -->
                 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                     <h2 id="viewer-title" style="font-size: 24px; font-weight: 600; color: #333; margin: 0;">Destination Name</h2>
                      <button id="back-to-list-btn" class="btn btn-secondary" style="padding: 8px 18px; font-size: 15px;">
                          <i class="fas fa-arrow-left" style="margin-right: 6px;"></i> Back to List
                      </button>
                 </div>
                <p id="viewer-instructions" style="/* Styles will be added via CSS */">Loading...</p>
                <div id="viewer-container" style="/* Styles will be added via CSS */">
                    <div id="loading-indicator" style="/* Styles will be added via CSS */">
                        <div class="spinner"></div>
                        <span>Loading 360 View...</span>
                    </div>
                    <!-- A-Frame scene will be injected here -->
                </div>
            </div>

        </div> <!-- End Centering container -->
    </section>

        <!-- Footer -->
        <footer id="contact">
            <div class="footer-content">
                <div class="footer-info">
                    <div class="footer-logo">BhuYatra</div>
                    <p>Revolutionizing travel across India with AI, AR, and VR. Explore smarter, deeper, and more memorably.</p>
                    <div class="social-links">
                        <a href="#" class="fab fa-facebook-f" aria-label="Facebook"></a>
                        <a href="#" class="fab fa-twitter" aria-label="Twitter"></a>
                        <a href="#" class="fab fa-linkedin-in" aria-label="LinkedIn"></a>
                        <a href="#" class="fab fa-instagram" aria-label="Instagram"></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#how-it-works">How It Works</a></li>
                        <li><a href="#testimonials">Testimonials</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>Explore</h3>
                    <ul>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press</a></li>
                        <li><a href="#">Partners</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-newsletter">
                    <h3>Stay Updated</h3>
                    <p>Subscribe for the latest features & travel tips.</p>
                    <form class="newsletter-form" id="newsletter-form">
                        <input type="email" placeholder="Your email address" required name="email">
                        <button type="submit" aria-label="Subscribe"><i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p> <span id="copyright-year"></span> BhuYatra. All rights reserved.</p>
            </div>
        </footer>
    </div> <!-- End Main Container -->


    <!-- START: Chatbot HTML -->
    <div class="chat-toggle" id="chat-toggle-btn" aria-label="Toggle Chatbot">
        <i class="fas fa-comment-dots"></i>
    </div>
    <div class="chatbot-container" id="chatbot-window">
        <div class="chat-header">
            <h3>
                <img src="#" alt="BhuYatra Bot">
                BhuYatra Assistant
            </h3>
            <div class="header-icons">
                <button class="header-icon info-btn" aria-label="Chatbot Info">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="header-icon close-chat" aria-label="Close Chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dot"></div> <div class="typing-dot"></div> <div class="typing-dot"></div>
            </div>
            <div class="status-indicator" id="status-indicator"></div>
        </div>
        <div class="chat-footer">
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="Ask about India travel..." autocomplete="off">
                <div class="message-actions">
                    <button class="action-btn voice-btn" id="voice-btn" title="Voice Input" aria-label="Start Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="action-btn send-btn" id="send-btn" title="Send Message" aria-label="Send Message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Chatbot HTML -->


    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- Globals & Element Selectors ---
            const header = document.getElementById('main-header');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mainNavUl = document.getElementById('main-nav-ul');
            const navLinks = mainNavUl ? mainNavUl.querySelectorAll('a') : []; // Safety check
            const allSections = document.querySelectorAll('section[id]');
            const chatToggleBtn = document.getElementById('chat-toggle-btn');
            const chatbotWindow = document.getElementById('chatbot-window');
            const closeChatBtn = chatbotWindow ? chatbotWindow.querySelector('.close-chat') : null; // Safety check
            const chatBodyEl = document.getElementById('chat-body');
            const chatInputEl = document.getElementById('chat-input');
            const sendBtnEl = document.getElementById('send-btn');
            const voiceBtnEl = document.getElementById('voice-btn');
            const typingIndicatorEl = document.getElementById('typing-indicator');
            const statusIndicatorEl = document.getElementById('status-indicator');
            const infoBtn = chatbotWindow ? chatbotWindow.querySelector('.info-btn') : null; // Safety check
            const loader = document.getElementById('loader');
            const mainContent = document.getElementById('main-content');
            const loaderProgress = document.getElementById('loader-progress');

            // --- Loader Logic ---
            function handleLoader() {
                if (!loader || !loaderProgress || !mainContent) {
                    console.warn("Loader elements not found. Skipping loader.");
                    if (mainContent) mainContent.style.display = 'block';
                    initPage(); // Initialize page directly
                    return;
                }

                let progress = 0;
                loaderProgress.textContent = progress + '%'; // Initial display

                const interval = setInterval(() => {
                    progress += Math.floor(Math.random() * 10) + 1;
                    progress = Math.min(progress, 100); // Cap at 100

                    loaderProgress.textContent = progress + '%';

                    if (progress === 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            loader.style.opacity = '0';
                            loader.style.pointerEvents = 'none'; // Prevent interaction
                            setTimeout(() => {
                                if (loader) loader.style.display = 'none'; // Check if loader exists before hiding
                                if (mainContent) mainContent.style.display = 'block';
                                initPage(); // Initialize animations and chat toggle
                            }, 500); // Wait for fade out
                        }, 300); // Short delay after reaching 100%
                    }
                }, 150); // Faster interval
            }

            // --- Page Initialization ---
            function initPage() {
                animateHeroElements();
                observeAnimatedElements();
                setupScrollListener(); // For header & nav highlighting
                if (chatToggleBtn) {
                    setTimeout(() => chatToggleBtn.classList.add('visible'), 300);
                } else {
                    console.warn("Chat toggle button not found.");
                }
                setCopyrightYear();
                setupFormSubmissions();
                setupArVrModal(); // Initialize AR/VR Modal Logic
                initializeChatbot(); // Initialize Chatbot Logic
            }

            // --- Animations ---
            function animateHeroElements() {
                 const heroElements = document.querySelectorAll('.hero-tagline, .hero-title, .hero-description, .hero-form, .cta-buttons');
                 heroElements.forEach(el => {
                    if (el) {
                         // Ensure animation runs by forcing reflow
                        void el.offsetWidth;
                        el.style.animationPlayState = 'running';
                    }
                 });
            }

            function observeAnimatedElements() {
                const elementsToAnimate = document.querySelectorAll(
                    '.feature-card, .step, .testimonial-item, .about-content, .about-image, .ar-feature, .vr-feature'
                 );

                if ('IntersectionObserver' in window) {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.style.opacity = '1';
                                entry.target.style.transform = 'translateY(0)';
                                // Optional: Unobserve after animation
                                // observer.unobserve(entry.target);
                            }
                        });
                    }, { threshold: 0.1 }); // Adjusted threshold slightly

                    elementsToAnimate.forEach(el => {
                        if(el) observer.observe(el);
                    });
                } else {
                    // Fallback for older browsers
                    elementsToAnimate.forEach(el => {
                        if(el) {
                             el.style.opacity = '1';
                             el.style.transform = 'translateY(0)';
                        }
                    });
                }
            }

            // --- Header & Navigation ---
            function setupScrollListener() {
                let lastScrollTop = 0;
                window.addEventListener('scroll', () => {
                    let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

                    // Sticky Header
                    if (header) {
                        if (scrollTop > 50) {
                            header.classList.add('scrolled');
                        } else {
                            header.classList.remove('scrolled');
                        }
                    }

                    // Active Nav Link Highlighting
                    let currentSection = '';
                    allSections.forEach(section => {
                         if (section) {
                            const sectionTop = section.offsetTop - (header ? header.offsetHeight : 70) - 50; // Offset for header & buffer
                            if (scrollTop >= sectionTop) {
                                currentSection = section.getAttribute('id');
                            }
                         }
                    });

                    navLinks.forEach(link => {
                         if (link) {
                            link.classList.remove('active');
                             // Check if href exists and matches the current section
                            const href = link.getAttribute('href');
                            if (href && href === `#${currentSection}`) {
                                link.classList.add('active');
                            }
                         }
                    });

                    lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // For Mobile or negative scrolling
                }, false);
            }

            // Mobile Menu Toggle
             if (mobileMenuToggle && mainNavUl) {
                mobileMenuToggle.addEventListener('click', () => {
                    const isExpanded = mainNavUl.classList.toggle('active');
                    mobileMenuToggle.setAttribute('aria-expanded', isExpanded);
                     // Change icon based on state
                     mobileMenuToggle.innerHTML = isExpanded ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                });

                // Close menu when a link is clicked
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        if (mainNavUl.classList.contains('active')) {
                            mainNavUl.classList.remove('active');
                            mobileMenuToggle.setAttribute('aria-expanded', 'false');
                             mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                        // Smooth scroll still works due to global setting and href="#section"
                    });
                });
                 // Close menu if clicking outside
                 document.addEventListener('click', (event) => {
                      if (mainNavUl.classList.contains('active') && !mainNavUl.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                            mainNavUl.classList.remove('active');
                            mobileMenuToggle.setAttribute('aria-expanded', 'false');
                            mobileMenuToggle.innerHTML = '<i class="fas fa-bars"></i>';
                      }
                 });
            } else {
                 console.warn("Mobile menu toggle or nav list not found.");
            }


            // --- Footer ---
            function setCopyrightYear() {
                const yearSpan = document.getElementById('copyright-year');
                if(yearSpan) {
                    yearSpan.textContent = new Date().getFullYear();
                }
            }

            // --- Form Submissions ---
            function setupFormSubmissions() {
                 const quickPlanForm = document.getElementById('quick-plan-form');
                 if (quickPlanForm) {
                     quickPlanForm.addEventListener('submit', (e) => {
                         e.preventDefault();
                         const formData = new FormData(quickPlanForm);
                         const destination = formData.get('destination');
                         // In a real app, send this data or open the chatbot with context
                         alert(`Planning itinerary for ${destination}... (Demo)`);
                         // Example: Open chatbot with context
                         if (chatToggleBtn && chatbotWindow && !chatbotWindow.classList.contains('active')) {
                              // Directly call chatbot functions if needed, or simulate click
                              toggleChatbot(); // Use the function to open chat if available
                              setTimeout(() => { // Wait for chat to open
                                   if(chatInputEl) chatInputEl.value = `Plan a trip to ${destination}`;
                                   // Optionally trigger send: handleSendMessage(); // Use chatbot's send function
                              }, 500);
                         } else if (chatInputEl && chatbotWindow?.classList.contains('active')) {
                              // If chat is already open, just set the input
                              chatInputEl.value = `Plan a trip to ${destination}`;
                              // Optionally trigger send: handleSendMessage();
                         }
                         quickPlanForm.reset();
                     });
                 }

                 const newsletterForm = document.getElementById('newsletter-form');
                 if (newsletterForm) {
                     newsletterForm.addEventListener('submit', (e) => {
                         e.preventDefault();
                          const emailInput = newsletterForm.querySelector('input[type="email"]');
                           if (emailInput) {
                               alert(`Subscribing ${emailInput.value}... (Demo)`);
                               // Add actual subscription logic here (e.g., fetch call)
                               newsletterForm.reset();
                           }
                     });
                 }
            }

             // --- Quick Demo Button --- (Placeholder)
             const quickDemoBtn = document.getElementById('quick-demo-btn');
             if (quickDemoBtn) {
                  quickDemoBtn.addEventListener('click', (e) => {
                       e.preventDefault();
                        alert("Showing Quick Demo... (Interactive tour simulation would go here)");
                       // Add code to start a guided tour or feature highlight
                  });
             }

            // --- START: AR/VR Modal Logic ---
            function setupArVrModal() {
                const openModalBtn = document.getElementById('open-ar-vr-popup');
                const modal = document.getElementById('ar-vr-modal');
                const overlay = document.getElementById('ar-vr-modal-overlay');
                const closeModalBtn = document.getElementById('close-modal-btn');
                const showVrBtn = document.getElementById('show-vr-btn');
                const showArBtn = document.getElementById('show-ar-btn');
                const vrContent = document.getElementById('vr-content');
                const arContent = document.getElementById('ar-content');
                const modalInstructions = document.getElementById('modal-instructions');
                const modalViews = document.querySelectorAll('.modal-view');
                const tabButtons = document.querySelectorAll('.modal-tab-btn');

                 // Check if all essential modal elements exist
                 if (!openModalBtn || !modal || !overlay || !closeModalBtn || !showVrBtn || !showArBtn || !vrContent || !arContent || !modalInstructions) {
                    console.error("AR/VR Modal elements missing. Modal functionality disabled.");
                    if(openModalBtn) openModalBtn.disabled = true; // Disable button if modal won't work
                    return; // Exit setup if elements are missing
                 }

                // --- A-Frame Scene Templates ---

                // VR Scene (Taj Mahal 360 Example)
                function createVRScene() {
                    const sceneEl = document.createElement('a-scene');
                    sceneEl.setAttribute('embedded', ''); // Important for embedding in div
                    sceneEl.setAttribute('vr-mode-ui', 'enabled: true'); // Enable VR button
                    sceneEl.setAttribute('cursor', 'rayOrigin: mouse; fuse: false;'); // Basic mouse interaction
                    sceneEl.setAttribute('renderer', 'colorManagement: true'); // Recommended for better colors

                    // VERY IMPORTANT: Use a readily available, CORS-enabled 360 image URL
                    // Using Wikimedia Commons image (check license/terms before using in production)
                    const imageUrl = 'https://upload.wikimedia.org/wikipedia/commons/c/bd/Taj_Mahal_%28Edited%29.jpeg';
                     // Placeholder if needed: 'https://placehold.co/4096x2048/0077b6/ffffff?text=360+View+Here'

                    sceneEl.innerHTML = `
                        <a-assets>
                            <img id="skyTexture" src="${imageUrl}" crossorigin="anonymous">
                        </a-assets>
                        <a-sky src="#skyTexture" rotation="0 -130 0"></a-sky>
                        <a-camera position="0 1.6 0" look-controls="enabled: true; reverseMouseDrag: false" wasd-controls="enabled: false">
                            <!-- Optional simple cursor -->
                             <!-- <a-entity cursor="fuse: false;"
                                      position="0 0 -1"
                                      geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                                      material="color: white; shader: flat; opacity: 0.6">
                            </a-entity> -->
                        </a-camera>
                    `;
                    return sceneEl;
                }

                // AR Scene (Hiro Marker Example)
                function createARScene() {
                    const sceneEl = document.createElement('a-scene');
                    sceneEl.setAttribute('embedded', '');
                    // AR.js configuration: Use webcam, disable debug UI
                    sceneEl.setAttribute('arjs', 'sourceType: webcam; trackingMethod: best; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;');
                    sceneEl.setAttribute('renderer', 'logarithmicDepthBuffer: true; colorManagement: true; antialias: true;'); // Helps with rendering scale & quality
                    sceneEl.setAttribute('vr-mode-ui', 'enabled: false'); // Disable VR button in AR mode

                    // Content to show on the marker
                    const markerContent = `
                        <a-box position='0 0.5 0' material='color: #00b4d8; opacity: 0.9; metalness: 0.2; roughness: 0.8;' scale='0.6 0.6 0.6'
                               animation__spin="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear;">
                        </a-box>
                        <a-text value="Taj Mahal\nAgra, India" position='0 1.1 0' align='center' color='#FFFFFF'
                                scale='0.5 0.5 0.5' rotation="-90 0 0" wrap-count="20"
                                geometry="primitive: plane; width: auto; height: auto; margin: 0.1" material="color: #333; opacity: 0.7" >
                        </a-text>
                    `;

                    sceneEl.innerHTML = `
                        <!-- Use a predefined marker (Hiro) -->
                        <a-marker preset='hiro'>
                            ${markerContent}
                        </a-marker>

                        <!-- Define the camera for AR -->
                        <a-entity camera></a-entity>
                    `;
                    return sceneEl;
                }

                // --- Modal Control Functions ---

                function openModal() {
                    modal.classList.add('active');
                    overlay.classList.add('active');
                    // Load the default view (VR) when opening
                    switchView('vr'); // Load VR by default
                }

                function closeModal() {
                    modal.classList.remove('active');
                    overlay.classList.remove('active');
                    // IMPORTANT: Clean up A-Frame scenes when closing to free resources
                    clearViewContent(vrContent);
                    clearViewContent(arContent);
                    // Reset tabs to default
                    if (showVrBtn) showVrBtn.classList.add('active');
                    if (showArBtn) showArBtn.classList.remove('active');
                    if (vrContent) vrContent.classList.add('active');
                    if (arContent) arContent.classList.remove('active');
                    if (modalInstructions) modalInstructions.innerHTML = ''; // Clear instructions
                }

                function clearViewContent(viewElement) {
                    if (!viewElement) return;
                    // Check if an A-Frame scene exists and remove it properly
                    const scene = viewElement.querySelector('a-scene');
                    if (scene) {
                        if (scene.parentNode === viewElement) {
                            try {
                                 // Attempt A-Frame specific cleanup if possible/needed
                                 if (scene.hasLoaded) {
                                      scene.pause(); // Pause scene activity
                                      // You might need more specific component cleanup depending on complexity
                                 }
                                viewElement.removeChild(scene); // Remove from DOM
                                console.log("Removed A-Frame scene from:", viewElement.id);
                            } catch (e) {
                                console.error("Error removing A-Frame scene:", e);
                                // Fallback cleanup if removeChild fails unexpectedly
                                viewElement.innerHTML = '';
                            }
                        } else {
                             console.warn("Scene found but parent is not the expected viewElement.");
                             // Force clear if something went wrong with parentage
                             viewElement.innerHTML = '';
                        }
                    } else {
                         // If no scene, just clear any residual HTML
                         viewElement.innerHTML = '';
                    }

                    // Add back the placeholder safely
                    const placeholder = document.createElement('p');
                    placeholder.classList.add('loading-placeholder');
                    placeholder.textContent = 'Loading experience...';
                    viewElement.appendChild(placeholder);
                }


                function switchView(viewType) {
                     console.log("Switching view to:", viewType);
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    modalViews.forEach(view => {
                        const wasActive = view.classList.contains('active');
                        view.classList.remove('active');
                        // Clear previous content ONLY if it was the active view being switched FROM
                        if (wasActive) {
                           clearViewContent(view);
                        }
                    });

                    let targetContent = null;
                    let targetButton = null;
                    let instructionsHTML = '';
                    let sceneCreator = null;

                    if (viewType === 'vr') {
                        targetContent = vrContent;
                        targetButton = showVrBtn;
                        instructionsHTML = `<strong>Instructions:</strong> Look around using your mouse or device gyroscope. Click the goggles icon <i class="fas fa-vr-cardboard" style="vertical-align: middle;"></i> for VR mode (if available).`;
                        sceneCreator = createVRScene;

                    } else if (viewType === 'ar') {
                        targetContent = arContent;
                        targetButton = showArBtn;
                        instructionsHTML = `<strong>Instructions:</strong> Allow camera access when prompted. Point your device's camera steadily at the <strong>Hiro marker</strong>.
                                               <br> <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/HIRO.png" target="_blank" rel="noopener noreferrer">View/Print Hiro Marker <i class="fas fa-external-link-alt" style="font-size: 0.8em;"></i></a>`;
                        sceneCreator = createARScene;
                    }

                     if (targetContent && targetButton && sceneCreator && modalInstructions) {
                        targetButton.classList.add('active');
                        targetContent.classList.add('active');
                        modalInstructions.innerHTML = instructionsHTML;

                        // Dynamically create and append the scene
                        clearViewContent(targetContent); // Ensure placeholder is removed before adding scene
                        const sceneElement = sceneCreator();
                        targetContent.appendChild(sceneElement);
                        console.log(viewType.toUpperCase() + " Scene Added");
                     } else {
                          console.error("Failed to switch view: Target elements or scene creator missing for type", viewType);
                     }
                }

                // --- Event Listeners ---
                 openModalBtn.addEventListener('click', openModal);
                 closeModalBtn.addEventListener('click', closeModal);
                 overlay.addEventListener('click', closeModal); // Close on overlay click

                 showVrBtn.addEventListener('click', () => switchView('vr'));
                 showArBtn.addEventListener('click', () => switchView('ar'));

                // Close modal on ESC key press
                 window.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && modal.classList.contains('active')) {
                        closeModal();
                    }
                 });

            } // --- END: setupArVrModal ---


            // --- START: Chatbot Logic ---
            function initializeChatbot() {
                const DEBUG = true; // Enable/disable console logs

                function debugLog(...args) {
                    if (DEBUG) console.log("[BhuYatra Chat]", ...args);
                }

                // Check essential chatbot elements again, as they might be needed by functions called later
                if (!chatToggleBtn || !closeChatBtn || !chatbotWindow || !chatBodyEl || !chatInputEl || !sendBtnEl || !voiceBtnEl || !typingIndicatorEl || !statusIndicatorEl || !infoBtn) {
                    console.error("One or more chatbot elements could not be found. Chatbot functionality disabled.");
                    if (chatToggleBtn) chatToggleBtn.style.display = 'none'; // Hide toggle if chatbot won't work
                    // Make the global toggleChatbot function safe to call even if chatbot isn't setup
                    window.toggleChatbot = () => console.warn("Chatbot not initialized.");
                    window.handleSendMessage = () => console.warn("Chatbot not initialized."); // Add safety for form submission call
                    return; // Stop chatbot initialization
                }

                debugLog("Initializing BhuYatra Assistant (using Groq)...");

                // --- Groq API Configuration ---
                const GROQ_API_KEY = "YOUR_GROQ_API_KEY_HERE"; // Replace with your actual key
                const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
                const MODEL_NAME = "mixtral-8x7b-32768";
                // --- END Groq Config ---

                const isApiKeyValid = GROQ_API_KEY && GROQ_API_KEY !== "YOUR_GROQ_API_KEY_HERE" && GROQ_API_KEY.length > 10;
                if (!isApiKeyValid) {
                     console.warn("Groq API Key seems invalid or is a placeholder. Chatbot will operate in offline mode.");
                     // Don't show status here yet, wait until chat opens
                }

                let conversationHistory = [];
                let isFirstInteraction = true;
                let isProcessing = false;
                let recognition = null;
                let currentStreamController = null; // To abort ongoing streams

                // Speech Recognition Setup
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'en-IN'; // Indian English

                    recognition.onresult = (event) => {
                        const transcript = event.results[event.results.length - 1][0].transcript; // Get last result
                        debugLog("Voice input transcript:", transcript);
                        if(chatInputEl) chatInputEl.value = transcript;
                        if(voiceBtnEl) voiceBtnEl.classList.remove('active');
                        if(voiceBtnEl) voiceBtnEl.setAttribute('aria-label', 'Start Voice Input');
                        handleSendMessage(); // Automatically send after speech
                    };
                    recognition.onerror = (event) => {
                         debugLog("Speech recognition error:", event.error, event.message);
                         if(voiceBtnEl) voiceBtnEl.classList.remove('active');
                         if(voiceBtnEl) voiceBtnEl.setAttribute('aria-label', 'Start Voice Input');
                         showStatus(`Speech error: ${event.error}. Please try again.`, 4000, 'error');
                    };
                    recognition.onend = () => {
                        debugLog("Speech recognition ended.");
                         // Ensure button state is reset even if no result/error
                         if(voiceBtnEl) voiceBtnEl.classList.remove('active');
                         if(voiceBtnEl) voiceBtnEl.setAttribute('aria-label', 'Start Voice Input');
                    };
                } else {
                    debugLog("Speech recognition not supported by this browser.");
                    if(voiceBtnEl) voiceBtnEl.style.display = 'none'; // Hide button if not supported
                }

                // --- Chatbot Event Listeners ---
                chatToggleBtn.addEventListener('click', toggleChatbot);
                closeChatBtn.addEventListener('click', closeChatbot);
                infoBtn.addEventListener('click', showChatbotInfo);
                sendBtnEl.addEventListener('click', handleSendMessage);
                chatInputEl.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                    }
                });
                // Add voice listener only if button is displayed (supported)
                if(voiceBtnEl && voiceBtnEl.style.display !== 'none') {
                    voiceBtnEl.addEventListener('click', handleVoiceInput);
                }


                // --- Chatbot Core Functions (made globally accessible for form submission) ---
                window.toggleChatbot = function() { // Assign to window scope
                    const isActive = chatbotWindow.classList.toggle('active');
                    chatToggleBtn.classList.toggle('active');
                    // Toggle body class for overflow only on mobile when opening fully
                    document.body.classList.toggle('chatbot-open', isActive && window.innerWidth <= 768);

                    if (isActive && isFirstInteraction) {
                        isFirstInteraction = false;
                        initiateChatDisplay(); // Call function to display initial message
                    } else if (!isActive) {
                         // Abort any ongoing stream if chat is closed
                         abortStream();
                    }
                     // Focus input when opening
                     if (isActive && chatInputEl) {
                          setTimeout(() => chatInputEl.focus(), 300); // Delay slightly for transition
                     }
                }

                function closeChatbot() { // Keep local scope unless needed elsewhere
                     chatbotWindow.classList.remove('active');
                     chatToggleBtn.classList.remove('active');
                     document.body.classList.remove('chatbot-open');
                     abortStream(); // Abort stream on close
                }

                // Renamed from initializeChat to avoid confusion with page init
                 function initiateChatDisplay() {
                    if (!chatBodyEl || !typingIndicatorEl || !statusIndicatorEl) return; // Safety check

                    chatBodyEl.innerHTML = ''; // Clear previous messages
                    // Ensure indicators are appended for correct structure
                    chatBodyEl.appendChild(typingIndicatorEl);
                    chatBodyEl.appendChild(statusIndicatorEl);


                    if (conversationHistory.length === 0) {
                        // Initial system prompt (only add once)
                        conversationHistory.push({
                            role: "system",
                            content: "You are BhuYatra, an intelligent travel assistant specializing in Indian tourism. Be friendly, helpful, and concise (use paragraphs, lists where appropriate). Focus on destinations, culture, food, travel tips, itineraries, AR/VR features (explain hypothetically based on the website's descriptions), and practical info for India. Ask clarifying questions if the user request is vague. Avoid starting every single message with 'Namaste!' or 'As BhuYatra...'. Keep responses relevant and engaging for someone planning a trip."
                         });
                    }

                    // Show offline warning if needed
                     if (!isApiKeyValid) {
                          showStatus("Chatbot is in offline mode (API key missing/invalid). Responses are limited.", 8000, 'error');
                     }

                    showTypingIndicator();
                    setTimeout(() => {
                        const welcomeSuggestions = [
                            "Suggest a place in Himachal", "Plan a 3-day Goa trip",
                            "What's special about Kerala?", "Tell me about the Taj Mahal",
                            "Best street food in Delhi?"
                        ];
                        // Use sendBotMessageUI for initial message display without history update
                        sendBotMessageUI("Namaste! I'm BhuYatra, your AI guide to exploring India. How can I help you plan your journey today?", welcomeSuggestions);
                        hideTypingIndicator();
                    }, 800);
                 }


                function showChatbotInfo() {
                     const infoSuggestions = [ "How does AR work?", "VR tour examples?", "Plan a trip" ];
                     sendBotMessageUI("I'm the BhuYatra Assistant! Ask me about Indian destinations, food, culture, itineraries, or our AR/VR features. I can provide real-time info and personalized suggestions to make your travel planning easier.", infoSuggestions);
                }

                function handleVoiceInput() {
                    if (!recognition) {
                        showStatus("Speech recognition not available in your browser.", 3000, 'error');
                        return;
                    }
                    if (voiceBtnEl.classList.contains('active')) {
                        recognition.stop();
                        debugLog("Speech recognition stopped manually.");
                        // onend handler will reset the button state
                    } else {
                         try {
                            voiceBtnEl.classList.add('active');
                            voiceBtnEl.setAttribute('aria-label', 'Stop Voice Input');
                            recognition.start();
                            debugLog("Speech recognition started.");
                         } catch (error) {
                             // Common error: recognition already started
                             if (error.name === 'InvalidStateError') {
                                 debugLog("Recognition already started, stopping previous instance.");
                                 recognition.abort(); // Try aborting previous one
                                 setTimeout(() => { // Retry starting after abort
                                     try {
                                         recognition.start();
                                         debugLog("Speech recognition restarted.");
                                     } catch (retryError) {
                                          debugLog("Error restarting speech recognition:", retryError);
                                          voiceBtnEl.classList.remove('active');
                                          voiceBtnEl.setAttribute('aria-label', 'Start Voice Input');
                                          showStatus("Could not start voice input.", 3000, 'error');
                                     }
                                 }, 300);
                             } else {
                                 debugLog("Error starting speech recognition:", error);
                                 voiceBtnEl.classList.remove('active');
                                 voiceBtnEl.setAttribute('aria-label', 'Start Voice Input');
                                 showStatus("Could not start voice input.", 3000, 'error');
                             }
                         }
                    }
                }

                window.handleSendMessage = function() { // Assign to window scope for form access
                    if (!chatInputEl || !chatBodyEl) return; // Safety check
                    const message = chatInputEl.value.trim();
                    if (!message || isProcessing) return;

                    abortStream(); // Abort previous stream if user sends new message quickly

                    debugLog("User message:", message);
                    addMessageToUI('user', message); // Display user message
                    conversationHistory.push({ role: "user", content: message }); // Add to history before API call
                    chatInputEl.value = '';
                    chatInputEl.focus(); // Keep focus on input
                    removeSuggestionPills();
                    scrollToBottom();
                    showTypingIndicator();
                    isProcessing = true;
                    disableInput(); // Disable input fields while processing

                    if (!isApiKeyValid) {
                         // Use offline response immediately
                         setTimeout(() => {
                              const offlineResponse = getOfflineResponse(message);
                              sendBotMessageUI(offlineResponse, ["Try asking differently", "Popular places in India?"]);
                              hideTypingIndicator();
                              isProcessing = false;
                              enableInput();
                         }, 800);
                    } else {
                         // Call the Groq API
                         processMessageWithGroqAPI(message);
                    }
                }

                function disableInput() {
                     if(chatInputEl) chatInputEl.disabled = true;
                     if(sendBtnEl) sendBtnEl.disabled = true;
                     if(voiceBtnEl) voiceBtnEl.disabled = true;
                }
                function enableInput() {
                     if(chatInputEl) chatInputEl.disabled = false;
                     if(sendBtnEl) sendBtnEl.disabled = false;
                     if(voiceBtnEl) voiceBtnEl.disabled = false;
                     if(chatInputEl) chatInputEl.focus(); // Re-focus after enabling
                }

                 // Adds message visually, returns the message element
                 function addMessageToUI(sender, text) {
                     const messageDiv = document.createElement('div');
                     messageDiv.classList.add('message', `${sender}-message`);
                     const iconHTML = sender === 'bot' ? '<i class="fas fa-robot"></i> ' : '';
                     const userIconHTML = sender === 'user' ? ' <i class="fas fa-user"></i>' : '';

                     // Create a span for the content to allow streaming updates
                     const contentSpan = document.createElement('span');
                     contentSpan.classList.add(`${sender}-message-content`);

                     // Set initial text using textContent for safety against XSS
                     // If streaming, this will be updated incrementally
                     contentSpan.textContent = text || ''; // Handle empty initial text

                     // Construct the inner HTML safely
                     if (sender === 'bot') {
                         messageDiv.innerHTML = iconHTML; // Add bot icon
                         messageDiv.appendChild(contentSpan);
                     } else { // sender === 'user'
                         messageDiv.appendChild(contentSpan);
                         messageDiv.insertAdjacentHTML('beforeend', userIconHTML); // Add user icon after text
                     }

                     // Insert before the typing indicator or status indicator
                     const insertBeforeEl = typingIndicatorEl.classList.contains('active') ? typingIndicatorEl : statusIndicatorEl;
                     chatBodyEl.insertBefore(messageDiv, insertBeforeEl);
                     scrollToBottom();
                     return messageDiv; // Return the element for potential updates (like streaming)
                 }


                 // Only updates UI and adds suggestions, DOES NOT add to conversationHistory
                 function sendBotMessageUI(text, suggestions = []) {
                    const botMessageElement = addMessageToUI('bot', text);
                    removeSuggestionPills(); // Clear previous suggestions
                    if (suggestions.length > 0) {
                        addSuggestionPills(suggestions, botMessageElement); // Pass the message element to attach suggestions after
                    }
                    scrollToBottom();
                    // Typically called when bot response is fully received or for static messages
                }

                 // Modified to insert pills *after* a specific bot message element
                 function addSuggestionPills(suggestions, afterElement) {
                    if (!afterElement || !chatBodyEl) return;

                    const suggestionsDiv = document.createElement('div');
                    suggestionsDiv.classList.add('suggestion-pills');
                    suggestions.forEach(suggestion => {
                        const pill = document.createElement('button');
                        pill.classList.add('suggestion-pill');
                        pill.textContent = suggestion;
                        pill.type = 'button'; // Important for accessibility and form behavior
                        pill.addEventListener('click', () => {
                            debugLog("Suggestion clicked:", suggestion);
                            if (chatInputEl && !isProcessing) { // Check if not processing
                                chatInputEl.value = suggestion;
                                handleSendMessage(); // Send suggestion as user message
                            }
                        });
                        suggestionsDiv.appendChild(pill);
                    });

                    // Insert the pills div after the specified bot message element
                     afterElement.insertAdjacentElement('afterend', suggestionsDiv);

                    scrollToBottom(); // Scroll again after adding pills
                }

                function removeSuggestionPills() {
                    const existingPills = chatBodyEl.querySelectorAll('.suggestion-pills'); // Select all
                     existingPills.forEach(pillsDiv => pillsDiv.remove()); // Remove all instances
                }

                function showStatus(message, duration = 4000, type = 'info') { // type: 'info' or 'error'
                     if (!statusIndicatorEl) return;
                     debugLog("Status:", message);
                     statusIndicatorEl.textContent = message;
                     statusIndicatorEl.className = 'status-indicator active'; // Reset classes
                     if(type === 'error') {
                         statusIndicatorEl.classList.add('error');
                     }
                    // Clear any existing timeout
                    clearTimeout(statusIndicatorEl.timeoutId);
                    // Set new timeout to hide the status
                    statusIndicatorEl.timeoutId = setTimeout(() => {
                        statusIndicatorEl.classList.remove('active');
                     }, duration);
                }

                function abortStream() {
                     if (currentStreamController) {
                          debugLog("Aborting previous API stream request.");
                          currentStreamController.abort();
                          currentStreamController = null;
                          // Make sure UI reflects stoppage if needed (e.g., remove half-finished message or add ellipsis)
                          // Current implementation just stops adding text, which might be acceptable.
                     }
                }

                // --- START: Groq API Call Logic ---
                 async function processMessageWithGroqAPI(userMessage) {
                     // Use the current conversation history for context
                     const messagesToSend = [...conversationHistory];

                     // Limit history length to avoid overly large payloads (adjust as needed)
                     const MAX_HISTORY_MESSAGES = 10; // Keep last 5 user/assistant pairs + system prompt
                     if (messagesToSend.length > MAX_HISTORY_MESSAGES + 1) {
                          messagesToSend.splice(1, messagesToSend.length - (MAX_HISTORY_MESSAGES + 1)); // Remove older messages, keeping system prompt
                          debugLog("Trimmed conversation history to:", messagesToSend.length, "messages");
                     }


                    const payload = {
                        model: MODEL_NAME,
                        messages: messagesToSend, // Send potentially trimmed history
                        temperature: 0.7, // Slightly higher for more varied responses
                        max_tokens: 1024,
                        top_p: 1, // Standard default
                        stream: true,
                        stop: null // Let the model decide when to stop
                    };

                    // Create a new AbortController for this request
                    currentStreamController = new AbortController();
                    const signal = currentStreamController.signal;
                    const timeoutId = setTimeout(() => currentStreamController.abort("timeout"), 25000); // 25 second timeout

                    // Create the bot message element in the UI immediately, but empty
                    const botMessageElement = addMessageToUI('bot', ''); // Pass empty string
                    const botContentSpan = botMessageElement.querySelector('.bot-message-content');
                    if (!botContentSpan) {
                         console.error("Could not find content span in bot message element!");
                         hideTypingIndicator();
                         isProcessing = false;
                         enableInput();
                         return;
                    }
                    let fullBotResponse = ""; // To store the complete response for history

                    try {
                        const response = await fetch(GROQ_API_URL, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${GROQ_API_KEY}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload),
                            signal: signal // Pass the signal here
                        });

                        clearTimeout(timeoutId); // Clear timeout if fetch starts receiving

                        if (!response.ok || !response.body) {
                             const errorText = await response.text().catch(() => 'Unknown API error');
                             debugLog(`Groq API Error (${response.status}):`, errorText);
                            throw new Error(`API request failed: ${response.status} ${response.statusText}. ${errorText}`);
                        }

                        // Process the stream
                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();
                        hideTypingIndicator(); // Hide typing indicator once stream starts

                        while (true) {
                            // Check if aborted before reading next chunk
                            if (signal.aborted) {
                                 debugLog("Stream reading aborted.");
                                 reader.releaseLock(); // Release lock if aborted
                                 break; // Exit loop
                            }

                            const { value, done } = await reader.read();
                            if (done) {
                                debugLog("Stream finished.");
                                break;
                            }

                            const chunk = decoder.decode(value, { stream: true }); // Use stream: true for better multi-byte char handling
                            // SSE format splits messages by \n\n
                            const lines = chunk.split('\n\n');

                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    const dataContent = line.substring(6).trim();
                                    if (dataContent === '[DONE]') {
                                         debugLog("Stream marked [DONE].");
                                         // No need to break here, wait for reader.read() done
                                    } else {
                                        try {
                                            const parsed = JSON.parse(dataContent);
                                            const deltaContent = parsed.choices?.[0]?.delta?.content;
                                            if (deltaContent) {
                                                fullBotResponse += deltaContent;
                                                // Append text content directly
                                                botContentSpan.textContent += deltaContent; // Append to existing text
                                                scrollToBottom(); // Keep scrolling as content arrives
                                            }
                                            // Handle finish reason if needed (e.g., length limit)
                                            // const finishReason = parsed.choices?.[0]?.finish_reason;
                                            // if (finishReason && finishReason !== 'stop') {
                                            //    debugLog("Stream stopped unexpectedly:", finishReason);
                                            // }
                                        } catch (parseError) {
                                            debugLog("Error parsing stream data chunk:", parseError, "Chunk:", line);
                                        }
                                    }
                                }
                            }
                        }
                        // Ensure lock is released if loop finishes normally
                        if (!signal.aborted) {
                             reader.releaseLock();
                        }

                        // Add the complete response to history *after* stream finishes or is aborted
                        if (fullBotResponse) {
                             conversationHistory.push({ role: "assistant", content: fullBotResponse });
                             // Add suggestions based on the final response (optional)
                             // const suggestions = extractSuggestions(fullBotResponse);
                             // addSuggestionPills(suggestions, botMessageElement);
                        } else if (!signal.aborted) {
                             // Only show 'no response' if not intentionally aborted
                            debugLog("Stream ended but no content received.");
                            botContentSpan.textContent = "(No response received from AI)";
                        } else if (signal.aborted && botContentSpan.textContent === '') {
                             // If aborted before any content arrived
                             botContentSpan.textContent = "(Request cancelled)";
                        }


                    } catch (error) {
                        clearTimeout(timeoutId); // Ensure timeout is cleared on error
                        if (error.name === 'AbortError') {
                             debugLog("API Fetch aborted:", error.message);
                              // Update UI to show cancelled/timeout status if needed
                             if (botContentSpan.textContent === '') botContentSpan.textContent = `(Request ${error.message === 'timeout' ? 'timed out' : 'cancelled'})`;
                             // Don't show generic error status if aborted
                        } else {
                             debugLog("Error during Groq API call or streaming:", error);
                             hideTypingIndicator();
                             // Update the potentially empty bot message with error info
                             botContentSpan.textContent = `(Error: ${error.message})`;
                             showStatus(`API Error: ${error.message}. Try again later.`, 6000, 'error');
                        }

                    } finally {
                        hideTypingIndicator(); // Ensure indicator is hidden
                        isProcessing = false; // Allow user input again
                        enableInput();
                        currentStreamController = null; // Clear controller ref
                        scrollToBottom(); // Final scroll
                    }
                }
                // --- END: Groq API Call Logic ---

                // Simple suggestion extraction (Placeholder - needs refinement based on actual model output)
                function extractSuggestions(text) {
                    // This is very basic, might need NLP or better pattern matching
                    const suggestions = new Set();
                    const maxSuggestions = 3;
                    // Look for questions at the end of sentences
                    const questionPattern = /([A-Z][^.!?]*)\?/g;
                    let match;
                    while((match = questionPattern.exec(text)) !== null && suggestions.size < maxSuggestions) {
                        let suggestion = match[1].trim();
                         if (suggestion.length > 10 && suggestion.length < 60 && !suggestion.toLowerCase().includes('you')) {
                             suggestions.add(suggestion + "?");
                         }
                    }
                     // Add generic fallback if no specific questions found
                     if (suggestions.size === 0) {
                         const generic = ["Tell me more about that.", "What are the main attractions?", "Is it expensive?"];
                         generic.slice(0, maxSuggestions).forEach(s => suggestions.add(s));
                     }
                    debugLog("Extracted Suggestions:", Array.from(suggestions));
                    return Array.from(suggestions);
                }


                function showTypingIndicator() {
                    if (typingIndicatorEl) typingIndicatorEl.classList.add('active');
                    scrollToBottom();
                }
                function hideTypingIndicator() {
                    if (typingIndicatorEl) typingIndicatorEl.classList.remove('active');
                }

                function scrollToBottom() {
                     if (!chatBodyEl) return;
                     // Use requestAnimationFrame for smoother scrolling after DOM updates
                     requestAnimationFrame(() => {
                        // Check if user is scrolled up significantly, if so, don't force scroll
                        const scrollThreshold = 100; // Pixels from bottom
                        if (chatBodyEl.scrollHeight - chatBodyEl.scrollTop - chatBodyEl.clientHeight < scrollThreshold) {
                             chatBodyEl.scrollTo({ top: chatBodyEl.scrollHeight, behavior: 'smooth' });
                        }
                     });
                }

                 function getOfflineResponse(query) {
                    query = query.toLowerCase().trim();
                    debugLog("Generating offline response for:", query);
                    const responses = {
                        "hello": "Namaste! (Offline) How can I assist with your India travel plans?", "hi": "Hi there! (Offline) Ask me about travel in India.",
                        "thank": "You're welcome! (Offline)", "help": "I can provide basic info about destinations, tips, food, culture for India. (Offline Mode)",
                        "about": "I'm BhuYatra, your AI travel companion for exploring India! (Offline Mode)",
                        "taj mahal": "(Offline) The Taj Mahal in Agra is a famous marble mausoleum. Consider visiting early morning.",
                        "goa": "(Offline) Goa is known for beaches and nightlife. Popular spots include Baga and Palolem.",
                        "kerala": "(Offline) Kerala is famous for its backwaters, tea gardens (Munnar), and beaches.",
                        "jaipur": "(Offline) Jaipur, the 'Pink City', features Amber Fort, Hawa Mahal, and City Palace.",
                        "delhi": "(Offline) Delhi offers historical sites like Red Fort and Qutub Minar, plus modern attractions.",
                        "itinerary": "(Offline) Please specify destination, duration, and interests for itinerary ideas.",
                        "plan": "(Offline) Tell me where you want to go and for how long to help plan!",
                        "best time": "(Offline) Generally, Oct-Mar is good for many parts of India. Summers suit hill stations.",
                        "food": "(Offline) India has diverse food! North Indian (curries), South Indian (dosa), street food, etc.",
                        "ar": "(Offline) AR could show info overlay on sites.",
                        "vr": "(Offline) VR could offer 360 tours of landmarks.",
                        "default": "I can provide basic information about travelling in India. Could you ask a more specific question? (Offline Mode)"
                    };
                    let bestMatch = "default"; let highestScore = 0;
                    // Simple keyword matching (can be improved)
                    for (const keyword in responses) {
                        if (keyword !== "default") {
                             const keywords = keyword.split(' ');
                             let score = 0;
                             keywords.forEach(k => {
                                 if (query.includes(k)) {
                                     score += k.length; // Simple scoring based on length
                                 }
                             });
                             if (score > highestScore) {
                                 highestScore = score;
                                 bestMatch = keyword;
                             }
                        }
                    }
                    debugLog(`Offline match: ${bestMatch} (Score: ${highestScore})`);
                    return responses[bestMatch];
                 }

            } // --- END: initializeChatbot ---

            // --- Initial Setup Call ---
            handleLoader(); // Start the loader process, which calls initPage() on completion

        }); // End DOMContentLoaded Listener
                // --- START: Integrated 360 Explorer Logic ---
                function setupIntegratedExploreView() {
            const openExploreBtn = document.getElementById('open-ar-vr-popup');
            const exploreContainerEl = document.getElementById('explore-360-view-container');
            const destinationListEl = document.getElementById('destination-list');
            const destinationSelectorEl = document.getElementById('destination-selector');
            const viewerSectionEl = document.getElementById('viewer-section');
            const viewerContainerEl = document.getElementById('viewer-container');
            const viewerTitleEl = document.getElementById('viewer-title');
            const viewerInstructionsEl = document.getElementById('viewer-instructions');
            const loadingIndicatorEl = document.getElementById('loading-indicator');
            const backToListBtn = document.getElementById('back-to-list-btn');
            const closeExploreBtn = document.getElementById('close-explore-view-btn'); // Button to close the whole view
            const mainSections = document.querySelectorAll('.main-container > section:not(#explore-360-view-container)'); // Select all direct child sections EXCEPT the explorer
            const footerEl = document.querySelector('footer'); // Select footer

             // Check if all elements exist
             if (!openExploreBtn || !exploreContainerEl || !destinationListEl || !destinationSelectorEl || !viewerSectionEl || !viewerContainerEl || !viewerTitleEl || !viewerInstructionsEl || !loadingIndicatorEl || !backToListBtn || !closeExploreBtn ) {
                 console.error("Integrated Explorer elements missing. Functionality disabled.");
                 if(openExploreBtn) openExploreBtn.disabled = true;
                 return;
             }

            // --- DESTINATION DATA ---
            // IMPORTANT: Use actual, high-quality, CORS-ENABLED 360 image URLs.
            const destinations = [
                 {
                    id: 'taj-mahal',
                    name: 'Taj Mahal, Agra',
                    description: 'Iconic ivory-white marble mausoleum.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/bd/Taj_Mahal_%28Edited%29.jpeg/320px-Taj_Mahal_%28Edited%29.jpeg',
                    imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/c/bd/Taj_Mahal_%28Edited%29.jpeg' // Example, verify license/usability
                },
                {
                    id: 'golden-temple',
                    name: 'Golden Temple, Amritsar',
                    description: 'The holiest Gurdwara of Sikhism.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Golden_Temple_-_Amritsar.jpg/320px-Golden_Temple_-_Amritsar.jpg',
                    // Needs REAL 360 image URL
                    imageUrl: 'https://live.staticflickr.com/65535/50442055258_cbba91934f_k.jpg' // Found one on Flickr - CHECK LICENSE/CORS
                },
                 {
                    id: 'india-gate',
                    name: 'India Gate, Delhi',
                    description: 'War memorial arch in the heart of Delhi.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/India_Gate_in_New_Delhi_03-2016.jpg/320px-India_Gate_in_New_Delhi_03-2016.jpg',
                    // Needs REAL 360 image URL
                    imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/a/ab/India_Gate_-_New_Delhi_-_World_War_I_Memorial_Arch_-_360_degree_view.jpg' // Example from Wikimedia - Check license/CORS
                },
                {
                    id: 'hawa-mahal',
                    name: 'Hawa Mahal, Jaipur',
                    description: 'Palace of Winds with intricate facade.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Hawa_Mahal_Unique_Angle.jpg/320px-Hawa_Mahal_Unique_Angle.jpg',
                    // Needs REAL 360 image URL:
                    imageUrl: 'https://live.staticflickr.com/4719/39209960744_0640a40c4a_k.jpg' // Flickr example - Check license/CORS
                },
                {
                    id: 'kerala-backwaters',
                    name: 'Kerala Backwaters',
                    description: 'Serene network of lakes and canals.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Backwaters_in_Kerala.jpg/320px-Backwaters_in_Kerala.jpg',
                    // Needs REAL 360 image URL:
                     imageUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Backwaters_in_Kerala.jpg/1920px-Backwaters_in_Kerala.jpg' // Example - check license/CORS
                },
                 {
                    id: 'victoria-memorial',
                    name: 'Victoria Memorial, Kolkata',
                    description: 'Grand marble building & museum.',
                    thumbnail: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Victoria_Memorial_Kolkata_India.jpg/320px-Victoria_Memorial_Kolkata_India.jpg',
                     // Needs REAL 360 image URL:
                    imageUrl: 'https://www.diyphotography.net/wp-content/uploads/2019/12/TakeBetter360PhotosAndVideosWithThese10Tips_1.jpg' // Example - Check license/CORS
                }
                // Add more destinations...
            ];

            // --- UI Control Functions ---
            function showExploreView() {
                console.log("Showing Explore View");
                // Hide main sections and footer
                mainSections.forEach(sec => sec.classList.add('hidden'));
                if(footerEl) footerEl.classList.add('hidden');
                // Show the explorer container
                exploreContainerEl.classList.remove('hidden');
                exploreContainerEl.style.display = 'block'; // Ensure it's block
                 // Reset to destination list view
                showDestinationList();
                // Scroll to the top of the explorer section
                exploreContainerEl.scrollIntoView({ behavior: 'smooth' });
                populateDestinations(); // Populate list every time it's opened
            }

            function closeExploreView() {
                 console.log("Closing Explore View");
                 exploreContainerEl.classList.add('hidden');
                 exploreContainerEl.style.display = 'none';
                 // Show main sections and footer again
                 mainSections.forEach(sec => sec.classList.remove('hidden'));
                 if(footerEl) footerEl.classList.remove('hidden');
                 clearVRScene(); // Clean up any active scene
                 // Scroll back to the AR/VR section or top might be better
                 document.getElementById('ar-vr')?.scrollIntoView({ behavior: 'smooth' });
            }

             function showDestinationList() {
                 destinationSelectorEl.classList.remove('hidden');
                 viewerSectionEl.classList.add('hidden');
                 viewerSectionEl.style.display = 'none'; // Hide viewer section properly
                 clearVRScene(); // Clean up scene when returning to list
             }

             function showViewer() {
                 destinationSelectorEl.classList.add('hidden');
                 viewerSectionEl.classList.remove('hidden');
                 viewerSectionEl.style.display = 'flex'; // Ensure flex layout applies
             }


            // --- Populate Destination List ---
            function populateDestinations() {
                destinationListEl.innerHTML = ''; // Clear existing
                destinations.forEach(dest => {
                    const card = document.createElement('div');
                    card.classList.add('destination-card');
                    card.dataset.id = dest.id;

                    const img = document.createElement('img');
                    img.src = dest.thumbnail;
                    img.alt = `Thumbnail of ${dest.name}`;
                    img.loading = 'lazy';

                    const title = document.createElement('h3');
                    title.textContent = dest.name;

                    const desc = document.createElement('p');
                    desc.textContent = dest.description;

                    card.appendChild(img);
                    card.appendChild(title);
                    card.appendChild(desc);

                    card.addEventListener('click', () => handleDestinationSelect(dest.id));
                    destinationListEl.appendChild(card);
                });
            }

            // --- Handle Destination Selection ---
            function handleDestinationSelect(id) {
                const selectedDest = destinations.find(d => d.id === id);
                if (!selectedDest) {
                    console.error('Destination not found:', id);
                    return;
                }
                console.log('Selected:', selectedDest.name);
                showViewer(); // Switch view within the explorer

                viewerTitleEl.textContent = selectedDest.name;
                setInstructions("Loading 360 view...", false);
                loadingIndicatorEl.classList.add('active'); // Show loader

                loadVRScene(selectedDest);
            }

            // --- Set Instructions/Error Message ---
            function setInstructions(message, isError = false) {
                viewerInstructionsEl.textContent = message;
                viewerInstructionsEl.classList.toggle('error', isError);
            }

             // --- Clear A-Frame Scene ---
             function clearVRScene() {
                 const currentScene = viewerContainerEl.querySelector('a-scene');
                 if (currentScene) {
                      try {
                          // Attempt graceful pause and removal
                          if (currentScene.hasLoaded) {
                               currentScene.pause();
                          }
                          currentScene.remove(); // A-Frame's method to detach and clean up
                          console.log("Cleared A-Frame scene.");
                      } catch (e) {
                          console.error("Error removing A-Frame scene:", e);
                          // Fallback: Force remove HTML content if specific remove fails
                          viewerContainerEl.innerHTML = '';
                           // Re-add the loading indicator structure if needed for next load
                           viewerContainerEl.innerHTML = `
                               <div id="loading-indicator" style="/* Styles will be added via CSS */">
                                   <div class="spinner"></div>
                                   <span>Loading 360 View...</span>
                               </div>`;

                      }
                 }
                  // Ensure loading indicator is hidden after cleanup
                 loadingIndicatorEl?.classList.remove('active');
             }


            // --- Load A-Frame VR Scene ---
            function loadVRScene(destination) {
                clearVRScene(); // Ensure previous scene is removed first

                const sceneEl = document.createElement('a-scene');
                sceneEl.setAttribute('embedded', '');
                sceneEl.setAttribute('vr-mode-ui', 'enabled: true');
                sceneEl.setAttribute('renderer', 'colorManagement: true');
                sceneEl.setAttribute('cursor', 'rayOrigin: mouse; fuse: false;');

                const assetsEl = document.createElement('a-assets');
                assetsEl.setAttribute('timeout', '20000'); // Increased timeout (20s)
                const imgAsset = document.createElement('img');
                imgAsset.id = 'skyTexture';
                imgAsset.src = destination.imageUrl;
                imgAsset.setAttribute('crossorigin', 'anonymous'); // Crucial

                imgAsset.onerror = () => {
                    console.error('Failed to load 360 image:', destination.imageUrl);
                    setInstructions(`Error: Could not load 360 image for ${destination.name}. Check URL or CORS policy.`, true);
                     loadingIndicatorEl.classList.remove('active');
                     sceneEl.remove(); // Remove the broken scene
                };
                 assetsEl.appendChild(imgAsset);
                 sceneEl.appendChild(assetsEl);

                 const skyEl = document.createElement('a-sky');
                 skyEl.setAttribute('src', '#skyTexture');
                 skyEl.setAttribute('rotation', '0 -90 0');
                 sceneEl.appendChild(skyEl);

                 const cameraEl = document.createElement('a-camera');
                 cameraEl.setAttribute('look-controls', 'enabled: true');
                 sceneEl.appendChild(cameraEl);

                 viewerContainerEl.appendChild(sceneEl);

                // --- Event Listeners for Scene Lifecycle ---
                 let sceneLoaded = false; // Flag to prevent multiple loads/errors
                 sceneEl.addEventListener('loaded', () => {
                     if (sceneLoaded) return; // Prevent double execution
                     sceneLoaded = true;
                     console.log(`A-Frame scene loaded for ${destination.name}`);
                     loadingIndicatorEl.classList.remove('active');
                     setInstructions('Look around! Click the goggles icon (if available) for VR mode.', false);
                 });

                 sceneEl.addEventListener('loaderror', (err) => {
                      if (sceneLoaded) return;
                      sceneLoaded = true; // Prevent further errors on this instance
                      console.error('A-Frame scene load error:', err);
                      setInstructions(`Error loading immersive view for ${destination.name}.`, true);
                      loadingIndicatorEl.classList.remove('active');
                 });

                 assetsEl.addEventListener('timeout', (err) => {
                      if (sceneLoaded) return;
                      sceneLoaded = true;
                      console.error('A-Frame asset loading timed out:', err.detail?.src);
                      setInstructions(`Error: Loading 360 image timed out for ${destination.name}.`, true);
                       loadingIndicatorEl.classList.remove('active');
                       sceneEl.remove(); // Remove scene if assets failed
                  });
             }

            // --- Event Listeners Setup ---
            openExploreBtn.addEventListener('click', showExploreView);
            closeExploreBtn.addEventListener('click', closeExploreView);
            backToListBtn.addEventListener('click', showDestinationList);

            // Initial state: Populate but keep hidden
             populateDestinations();
             exploreContainerEl.classList.add('hidden');
             exploreContainerEl.style.display = 'none';


        } // --- END: setupIntegratedExploreView ---

        // --- Modify initPage ---
        function initPage() {
            animateHeroElements();
            observeAnimatedElements();
            setupScrollListener(); // For header & nav highlighting
            if (chatToggleBtn) {
                setTimeout(() => chatToggleBtn.classList.add('visible'), 300);
            } else {
                console.warn("Chat toggle button not found.");
            }
            setCopyrightYear();
            setupFormSubmissions();
            // setupArVrModal(); // REMOVED THIS CALL
            setupIntegratedExploreView(); // ADDED THIS CALL
            initializeChatbot(); // Initialize Chatbot Logic
        }


        // --- Initial Setup Call ---
        handleLoader(); // Start the loader process, which calls initPage() on completion
    </script>

</body>
</html>
